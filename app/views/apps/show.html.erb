<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
  <div class="mb-8">
    <div class="flex items-center justify-between">
      <div>
        <h1 class="text-3xl font-bold text-gray-900"><%= @app.name %></h1>
        <p class="mt-2 text-gray-600"><%= @app.path %></p>
        <% if @app.last_scanned_at %>
          <p class="text-sm text-gray-500 mt-1">Last scanned <%= time_ago_in_words(@app.last_scanned_at) %> ago</p>
        <% end %>
      </div>
      <div class="flex gap-4">
        <%= button_to "Scan Now", scan_app_path(@app), method: :post, class: "bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700" %>
        <%= link_to "Back to Dashboard", root_path, class: "bg-gray-600 text-white px-4 py-2 rounded-lg hover:bg-gray-700" %>
      </div>
    </div>
  </div>

  <!-- Summary Cards -->
  <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
    <% @summaries.each do |summary| %>
      <div class="bg-white rounded-lg shadow p-6">
        <div class="text-sm font-medium text-gray-500"><%= summary.scan_type.titleize %></div>
        <div class="mt-2 text-3xl font-bold <%= summary.status == 'critical' ? 'text-red-600' : (summary.status == 'warning' ? 'text-yellow-600' : 'text-green-600') %>">
          <%= summary.total_issues %>
        </div>
        <div class="mt-2 text-sm text-gray-500">
          <% if summary.high_severity > 0 %>
            <span class="text-red-600"><%= summary.high_severity %> critical</span>
          <% end %>
          <% if summary.medium_severity > 0 %>
            <span class="text-yellow-600"><%= summary.medium_severity %> warnings</span>
          <% end %>
        </div>
      </div>
    <% end %>
  </div>

  <!-- Scan Type Tabs -->
  <div class="bg-white rounded-lg shadow">
    <div class="border-b border-gray-200">
      <nav class="-mb-px flex space-x-8 px-6" aria-label="Tabs">
        <% QualityScan::SCAN_TYPES.each_with_index do |scan_type, index| %>
          <% scans = @scans_by_type[scan_type] || [] %>
          <a href="#<%= scan_type %>"
             class="<%= index == 0 ? 'border-blue-500 text-blue-600' : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300' %> whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm tab-link"
             data-tab="<%= scan_type %>">
            <%= scan_type.titleize %>
            <% if scans.any? %>
              <span class="ml-2 <%= scans.any? { |s| ['critical', 'high'].include?(s.severity) } ? 'bg-red-100 text-red-600' : 'bg-gray-100 text-gray-600' %> py-0.5 px-2.5 rounded-full text-xs font-medium">
                <%= scans.count %>
              </span>
            <% end %>
          </a>
        <% end %>
      </nav>
    </div>

    <!-- Tab Content -->
    <div class="p-6">
      <% QualityScan::SCAN_TYPES.each_with_index do |scan_type, index| %>
        <div id="<%= scan_type %>" class="<%= index == 0 ? 'block' : 'hidden' %> tab-content">
          <% scans = @scans_by_type[scan_type] || [] %>

          <% if scans.any? %>
            <div class="space-y-4">
              <% scans.each do |scan| %>
                <div class="border border-gray-200 rounded-lg p-4 <%= scan.severity == 'critical' || scan.severity == 'high' ? 'border-l-4 border-l-red-500' : (scan.severity == 'medium' ? 'border-l-4 border-l-yellow-500' : '') %>">
                  <div class="flex items-start justify-between">
                    <div class="flex-1">
                      <div class="flex items-center gap-2">
                        <% if scan.severity %>
                          <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium <%= severity_badge_class(scan.severity) %>">
                            <%= scan.severity %>
                          </span>
                        <% end %>
                        <p class="text-sm font-medium text-gray-900"><%= scan.message %></p>
                      </div>

                      <% if scan.file_path %>
                        <div class="mt-2 text-sm text-gray-500">
                          <code class="bg-gray-100 px-2 py-1 rounded"><%= scan.file_path %><% if scan.line_number %>:<%= scan.line_number %><% end %></code>
                        </div>
                      <% end %>

                      <% if scan.metric_value %>
                        <div class="mt-1 text-sm text-gray-500">
                          Score: <%= scan.metric_value.round(2) %>
                        </div>
                      <% end %>
                    </div>
                    <div class="text-sm text-gray-400">
                      <%= time_ago_in_words(scan.scanned_at) %> ago
                    </div>
                  </div>
                </div>
              <% end %>
            </div>
          <% else %>
            <div class="text-center py-12">
              <p class="text-gray-500">No issues found in <%= scan_type.titleize %> scan</p>
            </div>
          <% end %>
        </div>
      <% end %>
    </div>
  </div>
</div>

<script>
  // Simple tab switching
  document.addEventListener('DOMContentLoaded', function() {
    const tabLinks = document.querySelectorAll('.tab-link');
    const tabContents = document.querySelectorAll('.tab-content');

    tabLinks.forEach(link => {
      link.addEventListener('click', function(e) {
        e.preventDefault();
        const tabName = this.dataset.tab;

        // Remove active classes
        tabLinks.forEach(l => {
          l.classList.remove('border-blue-500', 'text-blue-600');
          l.classList.add('border-transparent', 'text-gray-500');
        });

        // Add active class to clicked tab
        this.classList.remove('border-transparent', 'text-gray-500');
        this.classList.add('border-blue-500', 'text-blue-600');

        // Hide all content
        tabContents.forEach(content => content.classList.add('hidden'));

        // Show selected content
        document.getElementById(tabName).classList.remove('hidden');
      });
    });
  });
</script>
